{% extends "ProcesoBundle:All:Responsable/layout.html.twig" %}

{% block body %}

<div class="container" ng-app="listaActividadesModule" ng-controller="listaActividadesController" ng-cloak ng-init="devolucion = false">

  <div class="content">
    <div class="content-container">
      <uib-alert dismiss-on-timeout="4000" ng-repeat="alert in alerts" type="{[{alert.type}]}" close="closeAlert($index,alert.typeAlert)"><strong>{[{alert.msg}]}</strong></uib-alert>
      <div class="content-header">
        <h2 class="content-header-title"><strong>{[{response.actividad.nombre}]}</strong></h2> 
      </div>
      <div class="col-md-10">
        <label>Descripcion de la actividad: {[{response.actividad.descripcion}]}</label>
      </div>
       <!-- /.content-header -->
<!--         <div class="row" style="margin-bottom: 15px;" ng-repeat="(key, tarea) in response.actividad.tareas track by $index">
          <div class="col-md-3">
            <strong>Nombre de Tarea: {[{tarea.nombre}]}{[{$index}]}</strong>
          </div>
          <div ng-if="!tarea.filePath">
            <div class="col-md-3" ng-if="tarea.tipo == 1">
              <div name="{[{key}]}" type="button" class="btn btn-secondary" ngf-select ng-model="tarea.file" ngf-multiple="false">
                Seleccione el archivo
                </div>
            </div>
            <div class="col-md-3">
              <button ng-click="upload(tarea.file, key)" type="button" class="btn btn-secondary">Subir</button>
            </div>
          </div>
          <div ng-if="tarea.filePath">
               <div class="col-md-3"><a target="_blank" href="{{ asset('{[{tarea.filePath}]}') }}">{[{tarea.fileName}]}</a></div>
          </div>
        </div> -->
        <br>
        <div class="row" ng-repeat="(key, tarea) in response.actividad.tareas track by $index">
          <div class="col-sm-12">
            <div class="panel panel-default">
              <!-- Default panel contents -->
              <div class="panel-heading">
                <strong>
                  Nombre de Tarea Nro {[{$index+1}]}: {[{tarea.nombre}]}  {[{devolucion}]}
                </strong>
              </div>

              <!-- Table -->
              <div style="height: 60px;padding-top: 13px;">
                <div class="col-md-3">Descripcion: {[{tarea.descripcion}]} 
                </div>
                <div ng-if="tarea.tipo == 1">
                  <div ng-if="!tarea.filePath">
                      <div class="col-md-3">
                        <div name="{[{key}]}" type="button" class="btn btn-secondary"  ng-model="tarea.file" ngf-select="upload(tarea.file, key)" ngf-multiple="false">
                          Seleccione el archivo
                        </div>
                      </div>
                  </div>
                  <div ng-if="tarea.filePath">
                   <div class="col-md-3">
                     <label>Archivo: </label>
                     <a target="_blank" href="{{ asset('{[{tarea.filePath}]}') }}">
                     {[{tarea.fileName}]}
                     </a>
                   </div>
                  </div>
                </div>
                <div ng-if="tarea.tipo == 2 || tarea.tipo == 3 || tarea.tipo == 4">
                  <div>
                      <div class="col-md-3" ng-repeat="(key, documento) in response.actividad.tareas[key].documentos track by $index">
                        <div>
                          Archivo: <a target="_blank" href="{{ asset('{[{documento.path}]}') }}">{[{documento.nombre}]}</a>
                        </div>
                        <br>
                      </div>

                      <div class="col-md-3" ng-if="tarea.tipo == 2 ">
                        <button ng-if="!tarea.ejecutada" ng-click="ejecutarTarea(tarea.id, key)" type="button" class="btn btn-secondary">Verificar
                        </button>
                        <label ng-if="tarea.ejecutada" style="color:green"><i class="fa fa-check" aria-hidden="true"></i>Verificado</label>
                      </div>
                      <div class="col-md-3" ng-if="tarea.tipo == 3 ">
                        <button ng-click="ejecutarTarea(tarea.id, key)" type="button" class="btn btn-secondary">Analizar
                        </button>
                      </div>
                      <div class="col-md-3" ng-if="tarea.tipo == 4 ">
                        <button ng-click="ejecutarTarea(tarea.id, key)" type="button" class="btn btn-secondary">Aprobar
                        </button>
                      </div>
                  </div>
                </div>
              </div>
              </div>
            </div>
         </div>
        </div>
        <div align="center">
          <button  ng-click="devolucion = true" type="button" class="btn btn-secondary"><i class="fa fa-arrow-left" aria-hidden="true"></i> Desvolver Actividad</button> 
          <button ng-if="!devolucion" ng-click="ejecutarActividad()" type="button" class="btn btn-secondary">Ejecutar Actividad <i class="fa fa-arrow-right" aria-hidden="true"></i></button>
        </div>
        <div ng-if="devolucion" class="content-container">
          <div class="form-group">
            <label for="comment">Motivos de la devoluci√≥n:</label>
            <textarea ng-model="mensaje" class="form-control" rows="5" id="comment"></textarea>{[{mensaje}]}
          </div> 
          <div align="center">
             <button ng-click="devolverActividad(mensaje)" type="button" class="btn btn-secondary"><i class="fa fa-arrow-left" aria-hidden="true"></i> Enviar</button> 
          </div>
        </div>
        <br>
      </div>
   </div>
  </div>


{#         <div>Username
          <input type="text" ng-model="username"><br/><br/>
          watching model:
          <div class="button" ngf-select ng-model="file" ngf-multiple="false">Select File</div>
          
          Upload Log:
          <pre>{[{log}]}</pre> #}
      

{#{{dump(task)}}#}
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
          var response = "{{ data }}";
          var div = document.createElement('div');
          div.innerHTML = response;
          response = div.firstChild.nodeValue;
          response = JSON.parse(response);
          console.log("response",response);
     </script>
    
    <script src="{{ asset('bundles/proceso/js/ng-file-upload.min.js') }}"></script>
    <script src="{{ asset('bundles/proceso/js/ng-file-upload-shim.min.js') }}"></script>
   <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
   <script src="{{ path('fos_js_routing_js', {'callback': 'fos.Router.setData'}) }}"></script>
      <script src="{{ asset('bundles/proceso/js/angular/Responsable/listaActividadesModule.js') }}"></script>
   <script src="{{ asset('bundles/proceso/js/angular/Responsable/listaActividadesController.js') }}"></script>

{% endblock %}